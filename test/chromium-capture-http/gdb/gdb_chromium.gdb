# https://stackoverflow.com/questions/10748501
# what-are-the-best-ways-to-automate-a-gdb-debugging-session

# https://stackoverflow.com/a/31905135/10440128

set pagination off

set $i = 0

# dont ask: Make breakpoint pending on future shared library load?
set breakpoint pending on

#break BIO_read
# TODO find this address in BIO_read
#    0x000055555d496989 <+73>:    mov    ecx,eax
#    0x000055555d49698b <+75>:    add    QWORD PTR [rbx+0x30],rcx ; bio->num_read += ret;
break *0x000055555d496989
commands 1
  # no...
  #printf "buf %d %s\n", $eax, *($rbx)@$eax
  # print buf size
  printf "buf size=%d\n", $eax
  # print buf content
  # no. this stops on null bytes
  #printf "buf str=%s\n", *($rbx)@$eax

  # print buffer as string
  # 0x385801523b18: "\210\3239\001X8"
  #x/s *($rbx)@$eax

  # no...
  # print buffer raw
  #x/r *($rbx)@$eax

  # print buffer as hex
  # 0x336801514148: 0x014e37e8
  #x *($rbx)@$eax

  # hex
  # $31 = {0x14b4a88, 0x185c, 0x1, 0x1, 0x0, 0x0, 0x0, 0x3, 0x14c0930, 0x185c, 0x0, 0x0, 0x1640, 0x0, 0x76b, 0x0, 0x0, 0x1, 0x64c03a18, 0x5555, 0x0, 0x0, 0xf442b360, 0x7fff, 0x0, 0x0, 0x1506610}
  p/x *($rbx)@$eax

  # no
  #set $buf = *($rbx)@$eax
  #p/x $buf

  # decimal
  # $23 = {21630920, 3800, 1, 1, 0, 0, 0, 3, 22104704, 3800, 0, 0, 4928, 0, 1771, 0, 0, 1, 1690319384, 21845, 0, 0, -196955304, 32767, 0, 0}
  #print *($rbx)@$eax

  # https://stackoverflow.com/a/70988605/10440128
  # syntax error in expression
  #print (char[$eax])*($rbx)

  # decimal
  # $33 = {21620968, 15620, 1, 1, 0, 0, 0, 3, 21807776, 15620, 0, 0, 5728, 0, 1835, 0, 0, 1, 1690319384, 21845, 0, 0, -196956264, 32767, 0, 0, 21675872}
  #p/r *($rbx)@$eax

  # $33 = {21923816, 3488, 1, 1, 0, 0, 0, 3, 21944224, 3488, 0, 0, 5728, 0, 1725, 0, 0, 1, 1690319384, 21845, 0, 0, -196952712, 32767, 0, 0, 2238464}
  #p/s *($rbx)@$eax

  # verboooooose
  # $20 = {0x0151d388, 0x000034d4, 0x00000001, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000003, 0x014f5ce0, 0x000034d4, 0x00000000, 0x00000000, 0x0000014d, 0x00000000, 0x0000043a, 0x00000000, 0x00000000, 0x00000001, 0x00000001, 0xa0595201, 0x57f0c3d8, 0x00005555, 0x57f029c0, 0x00005555, 0x57ea6878, 0x00005555, 0x0087da90, 0x000034d4, 0x00000000, 0x00000000, 0x000282be, 0x00000000, 0x227f467d, 0x00000000, 0x00000001, 0x00000000, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555, 0x00000000, 0x00000000, 0xf44255f0, 0x00007fff, 0x00000000, 0x00000000, 0x002230e0, 0x00002444, 0x00239d10, 0x00002444, 0x53215531, 0x00000190, 0x000000c8, 0x000034d4, 0xf44255d4, 0x00007fff, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555, 0x00000000, 0x00000000, 0xf4425660, 0x00007fff, 0x00000000, 0x00000000, 0x0151abe0, 0x000034d4, 0x00239d10, 0x00002444, 0x53215531, 0x00000320, 0x00000000, 0x00000000, 0xf442565c, 0x00007fff, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555, 0x00000000, 0x00000000, 0xf44214a8, 0x00007fff, 0x00000000, 0x00000000, 0x002230e0, 0x00002444, 0x00239d10, 0x00002444, 0x53215531, 0x00000190, 0x000000c8, 0x00000000, 0xf442148c, 0x00007fff, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555, 0x00000000, 0x00000000, 0xf4421490, 0x00007fff, 0x00000000, 0x00000000, 0x002230e0, 0x00002444, 0x00239d10, 0x00002444, 0x53215531, 0x00000190, 0x00000000, 0x00000000, 0xf442148c, 0x00007fff, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555, 0x00000000, 0x00000000, 0xf4421430, 0x00007fff, 0x00000000, 0x00000000, 0x00929950, 0x000034d4, 0x00239d10, 0x00002444, 0x53215531, 0x00000038, 0x0000001c, 0x00000000, 0xf4421414, 0x00007fff, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555, 0x00000000, 0x00000000, 0xf4421418, 0x00007fff, 0x00000000, 0x00000000, 0x00929950, 0x000034d4, 0x00239d10, 0x00002444, 0x53215531, 0x00000038, 0x00000000, 0x00000000, 0xf4421414, 0x00007fff, 0x00000000, 0x00000001, 0x64ca0458, 0x00005555, 0xf4421448, 0x00007fff, 0x00000041, 0x00000000, 0x01526170, 0x000034d4, 0x01526120, 0x000034d4, 0x015261f0, 0x000034d4, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555, 0x00000000, 0x00000000, 0xf44213b0, 0x00007fff, 0x00000000, 0x00000000, 0x0110a8b0, 0x000034d4, 0x00239d10, 0x00002444, 0x53215531, 0x00000320, 0x00000190, 0x00000000, 0xf4421394, 0x00007fff, 0x00000000, 0x00000001, 0x64c03a18, 0x00005555...}
  #p/z *($rbx)@$eax

  continue
end

#break BIO_write

#printf "args:\n"
#show args
#printf "Note, however: in batch mode, arguments will be ignored!\n"

run
